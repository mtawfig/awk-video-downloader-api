const fs = require('fs');
const {
  extract,
  extractPhone,
  extractStreetAddress,
  extractAddressLocality,
  extractPostalCode,
  extractEmail,
  extractWebsite,
  extractAggregateRating,
  extractRatingCount,
  extractAbout,
  extractBusinessCreationDate,
} = require('./extractContent');

const wingnutsPage = fs.readFileSync('./test/fixtures/wingnuts.txt').toString();
const eatprayshopPage = fs.readFileSync('./test/fixtures/eatprayshop.txt').toString();
const fairebellesingaporePage = fs.readFileSync('./test/fixtures/fairebellesingapore.txt').toString();
const themindcafePage = fs.readFileSync('./test/fixtures/themindcafe.txt').toString();
const captivooPage = fs.readFileSync('./test/fixtures/captivoo.txt').toString();

describe('extractPhone', () => {
  it('returns phone number if found', () => {
    const phone1 = extractPhone(wingnutsPage);
    const phone2 = extractPhone(themindcafePage);

    expect(phone1).to.equal('+1 678-702-9990');
    expect(phone2).to.equal('63344426 / 96467271');
  });

  it('returns null if not found', () => {
    const phone1 = extractPhone(eatprayshopPage);
    const phone2 = extractPhone(fairebellesingaporePage);

    expect(phone1).to.be.null;
    expect(phone2).to.be.null;
  })
});

describe('extractStreetAddress', () => {
  it('returns street address if found', () => {
    const address1 = extractStreetAddress(wingnutsPage);
    const address2 = extractStreetAddress(themindcafePage);
    const address3 = extractStreetAddress(fairebellesingaporePage);

    expect(address1).to.equal('768 Marietta St NW');
    expect(address2).to.equal('60A Prinsep Street');
    expect(address3).to.equal('https:\\/\\/www.fairebelle.com');
  });

  it('returns null if not found', () => {
    const address = extractStreetAddress(eatprayshopPage);

    expect(address).to.be.null;
  });
  
});

describe('extractAddressLocality', () => {
  it('returns locality if found', () => {
    const locality1 = extractAddressLocality(wingnutsPage);
    const locality2 = extractAddressLocality(themindcafePage);

    expect(locality1).to.equal('Atlanta, Georgia');
    expect(locality2).to.equal('Singapore');
  });

  it('returns null if not found', () => {
    const locality1 = extractAddressLocality(fairebellesingaporePage);
    const locality2 = extractAddressLocality(eatprayshopPage);

    expect(locality1).to.be.null;
    expect(locality2).to.be.null;
  });
});

describe('extractPostalCode', () => {
  it('returns postal code if found', () => {
    const postalCode1 = extractPostalCode(wingnutsPage);
    const postalCode2 = extractPostalCode(themindcafePage);

    expect(postalCode1).to.equal('30318');
    expect(postalCode2).to.equal('188664');
  });

  it('returns null if not found', () => {
    const postalCode1 = extractPostalCode(fairebellesingaporePage);
    const postalCode2 = extractPostalCode(eatprayshopPage);

    expect(postalCode1).to.be.null;
    expect(postalCode2).to.be.null;
  });
});

describe('extractEmail', () => {
  it('returns email address if found', () => {
    const email1 = extractEmail(wingnutsPage);
    const email2 = extractEmail(themindcafePage);
    const email3 = extractEmail(fairebellesingaporePage);

    expect(email1).to.equal('wingnuts768@gmail.com');
    expect(email2).to.equal('admin@themindcafe.com.sg');
    expect(email3).to.equal('customer.service@fairebelle.com');
  });

  it('returns null if not found', () => {
    const email = extractEmail(eatprayshopPage);

    expect(email).to.be.null;
  });
});

describe('extractWebsite', () => {
  it('returns website if found', () => {
    const website1 = extractWebsite(wingnutsPage);
    const website2 = extractWebsite(themindcafePage);
    const website3 = extractWebsite(fairebellesingaporePage);
    const website4 = extractWebsite(eatprayshopPage);

    expect(website1).to.equal('https://ordering.chownow.com/order/7156/locations');
    expect(website2).to.equal('http://www.themindcafe.com.sg/index.php');
    expect(website3).to.equal('https://www.fairebelle.com');
    expect(website4).to.equal('http://www.eatprayshop.sg');
  });

  it('returns null if not found', () => {
    const website = extractWebsite(captivooPage);

    expect(website).to.be.null;
  });
});

describe('extractAggregateRating', () => {
  it('returns rating if found', () => {
    const rating = extractAggregateRating(wingnutsPage);

    expect(rating).to.equal('4.5')
  });

  it('returns null if not found', () => {
    const rating1 = extractAggregateRating(themindcafePage);
    const rating2 = extractAggregateRating(fairebellesingaporePage);
    const rating3 = extractAggregateRating(eatprayshopPage);

    expect(rating1).to.be.null;
    expect(rating2).to.be.null;
    expect(rating3).to.be.null;
  });
});

describe('extractRatingCount', () => {
  it('returns rating if found', () => {
    const rating = extractRatingCount(wingnutsPage);

    expect(rating).to.equal('26');
  });

  it('returns null if not found', () => {
    const rating1 = extractRatingCount(themindcafePage);
    const rating2 = extractRatingCount(fairebellesingaporePage);
    const rating3 = extractRatingCount(eatprayshopPage);

    expect(rating1).to.be.null;
    expect(rating2).to.be.null;
    expect(rating3).to.be.null;
  });
});

describe('extractAbout', () => {
  it('returns about if found', () => {
    const about1 = extractAbout(wingnutsPage);
    const about2 = extractAbout(themindcafePage);
    const about3 = extractAbout(fairebellesingaporePage);
    const about4 = extractAbout(eatprayshopPage);

    expect(about1).to.equal('Casual dining at its finest, catering to Georgia Tech campus and the surrounding community.');
    expect(about2).to.equal('International Board Games Cafe. Singapore&#039;s widest collection of boardgames in a cafe , &amp; hold Teambonding events using boardgames');
    expect(about3).to.equal('At Faire Belle, we strive to transform every woman to become classy and fabulous.');
    expect(about4).to.equal('Shop on ');
  });

  it('returns null if not found', () => {
    const website = extractAbout(captivooPage);

    expect(website).to.be.null;
  });
});

describe('extractBusinessCreationDate', () => {
  it('returns creation date if found', () => {
    const creation1 = extractBusinessCreationDate(themindcafePage);
    const creation2 = extractBusinessCreationDate(fairebellesingaporePage);
    const creation3 = extractBusinessCreationDate(eatprayshopPage);

    expect(creation1).to.equal('September 2004');
    expect(creation2).to.equal('15 August 2008');
    expect(creation3).to.equal('3 April 2013');
  });

  it('returns null if not found', () => {
    const creation = extractBusinessCreationDate(wingnutsPage);
    
    expect(creation).to.be.null;
  });
});

describe('extract', () => {
  it('returns the correct info', () => {
    const data1 = extract(wingnutsPage);
    const data2 = extract(themindcafePage);
    const data3 = extract(fairebellesingaporePage);
    const data4 = extract(eatprayshopPage);

    expect(data1).to.deep.equal({
      phone: '+1 678-702-9990',
      streetAddress: '768 Marietta St NW',
      addressLocality: 'Atlanta, Georgia',
      postalCode: '30318',
      email: 'wingnuts768@gmail.com',
      website: 'https://ordering.chownow.com/order/7156/locations',
      ratingAggregate: '4.5',
      ratingCount: '26',
      about: 'Casual dining at its finest, catering to Georgia Tech campus and the surrounding community.',
      creationDate: null
    });

    expect(data2).to.deep.equal({
      phone: '63344426 / 96467271',
      streetAddress: '60A Prinsep Street',
      addressLocality: 'Singapore',
      postalCode: '188664',
      email: 'admin@themindcafe.com.sg',
      website: 'http://www.themindcafe.com.sg/index.php',
      ratingAggregate: null,
      ratingCount: null,
      about: 'International Board Games Cafe. Singapore&#039;s widest collection of boardgames in a cafe , &amp; hold Teambonding events using boardgames',
      creationDate: 'September 2004'
    });

    expect(data3).to.deep.equal({
      phone: null,
      streetAddress: 'https:\\/\\/www.fairebelle.com',
      addressLocality: null,
      postalCode: null,
      email: 'customer.service@fairebelle.com',
      website: 'https://www.fairebelle.com',
      ratingAggregate: null,
      ratingCount: null,
      about: 'At Faire Belle, we strive to transform every woman to become classy and fabulous.',
      creationDate: '15 August 2008'
    });

    expect(data4).to.deep.equal({
      phone: null,
      streetAddress: null,
      addressLocality: null,
      postalCode: null,
      email: null,
      website: 'http://www.eatprayshop.sg',
      ratingAggregate: null,
      ratingCount: null,
      about: 'Shop on ',
      creationDate: '3 April 2013'
    });
  });
});
